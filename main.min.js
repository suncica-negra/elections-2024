const dropdown=document.querySelector(".dropdown"),loaderWrapper=document.querySelector(".loader_wrapper"),isMob=window.innerWidth<1024;let electionResults={};function getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function setLiveOrNot(e){e||(document.querySelector(".live").style.visibility="hidden")}function fixTooltipPosition(){const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);document.querySelectorAll(".tooltip_wrapper .tooltip").forEach((t=>{if(e&&t.classList.add("after_safari"),!isMob){const n=t.getBoundingClientRect();n.x+n.width>window.innerWidth&&(t.parentNode.style.left="unset",t.parentNode.style.right="90%",t.classList.add("hide_after","display_before"),t.parentNode.style.setProperty("--tooltipPadding","10px 20px 10px 5px"),e&&t.classList.add("hide_after","display_before_safari"))}}))}function placeDataInHtml(e,t=!0,n=!1){document.getElementById("election_results").replaceChildren();const o=t?e.ukupnoMandati:e,a=new DocumentFragment;o.forEach((e=>{const t=document.createElement("div");t.setAttribute("class","party_result_wrapper");const o=document.createElement("p");let s=n?"":e.naziv;n&&e.lista.forEach(((t,n)=>{n+1===e.lista.length?s+=t.naziv:s+=`${t.naziv}, `})),o.textContent=s,o.setAttribute("class","party"),t.appendChild(o);const i=document.createElement("div");setTimeout((()=>{isMob?i.style.width=e.brMandata/151*100+"%":i.style.height=e.brMandata/151*100+"%"}),150),i.style.backgroundColor=e.color?e.color:getRandomColor(),i.setAttribute("class","graph"),t.appendChild(i);const l=document.createElement("div");l.setAttribute("class","tooltip_wrapper scrollable_wrapper");const d=document.createElement("div");d.setAttribute("class","tooltip");const r=document.createElement("p");r.textContent="Lista stranaka unutar koalicije:",d.appendChild(r),l.appendChild(d);const c=document.createElement("ol");(n?e.lista[0].stranke:e.stranke).forEach((e=>{const t=document.createElement("li");t.textContent=e.naziv,c.appendChild(t)})),d.appendChild(c),t.appendChild(l);const p=document.createElement("p");p.textContent=e.brMandata,t.appendChild(p),a.appendChild(t)}));document.getElementById("election_results").appendChild(a),loaderWrapper.style.display="none",fixTooltipPosition()}function setUnitData(e){"012"===e?placeDataInHtml(electionResults.izborne_liste_manjine,!1,!0):electionResults.izborne_jedinice.forEach((t=>{t.ijSifra.includes(e)&&placeDataInHtml(t.lista,!1)}))}function processData(e,t=!1){if(!t){const t=document.getElementById("processed_votes_and_last_change_template").content.cloneNode(!0),n=t.getElementById("processed_votes");n.textContent=(e.processed_votes||"0%")+n.textContent;const o=t.getElementById("last_change"),a=new Date(e.time_updated),s=6e4*a.getTimezoneOffset(),i=new Date(a.getTime()-s).toLocaleTimeString().split(":").map((e=>e.padStart(2,"0")));o.textContent+=`${i.join(":").substring(0,5)} H`;document.getElementById("processed_votes_and_last_change").appendChild(t)}placeDataInHtml(e)}async function getElectionsData(e="https://showcase.24sata.hr/izbori2024/parliamentary-elections-2024.json"){fetch(e).then((e=>{if(e.ok)return e.json()})).then((e=>{electionResults=e,setLiveOrNot(e.live),processData(e)}))["catch"]((e=>{console.log(`Election results data were not retrieved due to: \n${e}`)}))}function debounce(e,t){let n=null;return function(){const o=this,a=arguments;clearTimeout(n),n=setTimeout((()=>{e.apply(o,a)}),t)}}window.addEventListener("pointerup",(e=>{const t=document.querySelector("svg");if(e.composedPath().includes(dropdown))if(dropdown.classList.contains("closed"))dropdown.classList.remove("closed"),t.classList.add("open");else{dropdown.classList.add("closed"),t.classList.remove("open");const n=e.target.dataset.unit;if(!n)return;loaderWrapper.style.display="block",document.querySelector("#target_unit").textContent=e.target.textContent,"0"===n?processData(electionResults,!0):setUnitData(n)}else dropdown.classList.add("closed"),t.classList.remove("open")})),document.addEventListener("DOMContentLoaded",(()=>{getElectionsData()})),window.addEventListener("resize",debounce((()=>{window.innerWidth<1024!==isMob&&window.location.reload()}),200));
