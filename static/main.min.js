const dropdown=document.querySelector(".dropdown"),loaderWrapper=document.querySelector(".loader_wrapper"),isMob=window.innerWidth<900;let electionResults={};function getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function setLiveOrNot(e){const t=document.querySelector(".live");t&&!e&&(t.style.visibility="hidden")}function fixTooltipPosition(){const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);e&&document.documentElement.style.setProperty("--textShadow","0 0 1.3px #090909");const t=document.querySelectorAll(".tooltip_wrapper .tooltip");t?.forEach((t=>{if(e&&t.classList.add("after_safari"),!isMob){const n=t.getBoundingClientRect();if(n&&n.x+n.width>window.innerWidth){const n=t.parentNode;n&&(n.style.left="unset",n.style.right="90%",n.style.setProperty("--tooltipPadding","10px 20px 10px 5px")),t.classList.add("hide_after","display_before"),e&&t.classList.add("hide_after","display_before_safari")}}}))}function placeDataInHtml(e,t=!0,n=!1){document.getElementById("election_results").replaceChildren();const o=t?e.ukupnoMandatiGrupirano:e;let a=151;const s=new DocumentFragment;o?.forEach(((e,o)=>{0===o&&(a=e.brMandata);const l=document.createElement("div");l.setAttribute("class","party_result_wrapper");const r=document.createElement("p");let i=n?"":e.naziv;n&&e.lista?.forEach(((t,n)=>{n+1===e.lista.length?i+=t.naziv:i+=`${t.naziv}, `})),r.textContent=i,r.setAttribute("class","party"),l.appendChild(r);const d=document.createElement("div");setTimeout((()=>{isMob?d.style.width=e.brMandata/a*100+"%":d.style.height=e.brMandata/a*100+"%"}),150);const c=e.color?e.color:getRandomColor();d.style.backgroundColor=c,e.hover?(d.style.setProperty("--graphHover",e.hover),d.style.filter="unset"):d.style.setProperty("--graphHover",c),d.setAttribute("class","graph");const p=document.createElement("div");p.setAttribute("class","graph_wrapper"),p.appendChild(d);const u=document.createElement("p");u.textContent=e.brMandata,p.appendChild(u),l.appendChild(p);const m=document.createElement("div");m.setAttribute("class","tooltip_wrapper scrollable_wrapper");const h=document.createElement("div");h.setAttribute("class","tooltip");const y=document.createElement("p");y.textContent="Lista stranaka unutar koalicije:",h.appendChild(y),m.appendChild(h);const f=document.createElement("ol");let g=e.political_parties;n?g=e.lista:t||n||(g=e.naziv.split(", ")),g?.forEach((e=>{const t=document.createElement("li");t.textContent=e.naziv||e,f.appendChild(t)})),h.appendChild(f),l.appendChild(m),s.appendChild(l)}));document.getElementById("election_results").appendChild(s),fixTooltipPosition(),loaderWrapper&&(loaderWrapper.style.display="none")}function setUnitData(e){"012"===e?placeDataInHtml(electionResults.izborne_liste_manjine,!1,!0):electionResults.izborne_jedinice?.forEach((t=>{t.ijSifra.includes(e)&&placeDataInHtml(t.lista,!1)}))}function processData(e,t=!1){if(!t){const t=document.getElementById("processed_votes_and_last_change_template").content.cloneNode(!0),n=t.getElementById("processed_votes"),o=e.status;n.textContent=`${o?.bmPosto}%`+n.textContent;const a=t.getElementById("last_change"),s=(o?.vrijeme)?.split(":"),l=s?.map((e=>e.padStart(2,"0")));a.textContent+=`${l?.join(":")} H`;document.getElementById("processed_votes_and_last_change").appendChild(t)}placeDataInHtml(e)}async function getElectionsData(e="https://showcase.24sata.hr/izbori2024/parliamentary-elections-2024-latest.json"){fetch(e).then((e=>{if(e.ok)return e.json()})).then((e=>{electionResults=e,setLiveOrNot(e.live),processData(e)}))["catch"]((e=>{console.log(`Election results data were not retrieved due to: \n${e}`)}))}function debounce(e,t){let n=null;return function(){const o=this,a=arguments;clearTimeout(n),n=setTimeout((()=>{e.apply(o,a)}),t)}}window.addEventListener("pointerup",(e=>{const t=document.querySelector("svg");if(dropdown&&e.composedPath().includes(dropdown))if(dropdown.classList.contains("closed"))dropdown.classList.remove("closed"),t?.classList.add("open");else{dropdown.classList.add("closed"),t?.classList.remove("open");const n=e.target.dataset.unit;if(!n)return;loaderWrapper&&(loaderWrapper.style.display="block");const o=document.querySelector("#target_unit");o&&(o.textContent=e.target?.textContent),"0"===n?processData(electionResults,!0):setUnitData(n)}else dropdown.classList.add("closed"),t?.classList.remove("open")})),document.addEventListener("DOMContentLoaded",(()=>{getElectionsData()})),window.addEventListener("resize",debounce((()=>{window.innerWidth<900!==isMob&&window.location.reload()}),200));
